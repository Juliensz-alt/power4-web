<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Power4 Web - Jeu Puissance 4</title>
    <link rel="stylesheet" href="/static/styles.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>üéØ Power4 Web</h1>
            <p class="subtitle">Jeu Puissance 4 en ligne</p>
        </header>

        <main>
            <!-- √âcran de menu avant le d√©but de la partie -->
            {{if not .Started}}
            <section class="menu-screen">
                <h2>Bienvenue dans Power4</h2>
                <p class="menu-subtitle">Pr√©parez-vous pour une partie de Puissance 4 !</p>

                <form action="/start" method="POST" class="menu-actions">
                    <button type="submit" class="btn btn-play">‚ñ∂ Jouer</button>
                </form>

                <div class="menu-extra-actions">
                    <a href="/rules" class="btn btn-secondary">üìú R√®gles</a>
                    <a href="/blank" class="btn btn-secondary">üîñ Page vide</a>
                </div>

                <p class="menu-hint">Astuce : cliquez sur une case du plateau pour d√©poser un jeton.</p>
            </section>
            {{end}}

            <!-- Informations du jeu -->
            <div class="game-info {{if not .Started}}hidden{{end}}">
                <div class="current-player">
                    <span class="label">Joueur actuel :</span>
                    <span class="player-indicator player-{{.CurrentPlayer}}">
                        Joueur {{.CurrentPlayer}}
                    </span>
                </div>
                <div class="game-status">
                    <span class="status-message">{{.Message}}</span>
                </div>
            </div>

            <!-- Plateau de jeu -->
            <div class="game-board {{if not .Started}}hidden{{end}}">
                <table class="board-table">
                    {{range $rowIndex, $row := .Board}}
                    <tr>
                        {{range $colIndex, $col := $row}}
                        <td class="cell {{if eq $col 1}}player-1{{else if eq $col 2}}player-2{{end}}" 
                            data-column="{{$colIndex}}">
                            {{if eq $col 1}}
                                <div class="token player-1">‚óè</div>
                            {{else if eq $col 2}}
                                <div class="token player-2">‚óè</div>
                            {{else}}
                                <div class="token empty"></div>
                            {{end}}
                        </td>
                        {{end}}
                    </tr>
                    {{end}}
                </table>
            </div>

            <!-- Actions secondaires (sans boutons de colonnes) -->
            <div class="action-buttons {{if not .Started}}hidden{{end}}">
                <a href="/" class="btn btn-secondary">Actualiser</a>
                <form action="/quit" method="POST" style="display: inline;">
                    <button type="submit" class="btn btn-secondary">Retour au menu</button>
                </form>
                <form action="/reset" method="POST" style="display: inline;">
                    <button type="submit" class="btn btn-primary">Nouvelle partie</button>
                </form>
            </div>

            <!-- Informations des joueurs -->
            <div class="players-info {{if not .Started}}hidden{{end}}">
                <div class="player-info player-1">
                    <div class="player-token">‚óè</div>
                    <span>{{.Player1Name}}</span>
                </div>
                <div class="player-info player-2">
                    <div class="player-token">‚óè</div>
                    <span>{{.Player2Name}}</span>
                </div>
            </div>

            <!-- Statut de fin de jeu -->
            {{if and .Started .GameOver}}
            <div class="game-over">
                {{if .Winner}}
                <h2>üéâ F√©licitations !</h2>
                <p>Le <strong>Joueur {{.Winner}}</strong> a gagn√© !</p>
                {{else}}
                <h2>ü§ù Match nul !</h2>
                <p>La grille est pleine, personne n'a gagn√©.</p>
                {{end}}
            </div>
            {{end}}
        </main>

        <footer>
            <p>Power4 Web - D√©velopp√© avec Go et HTML Templates</p>
        </footer>
    </div>

    <script>
        // Clique sur une cellule pour jouer dans la colonne correspondante
        document.querySelectorAll('.board-table td').forEach(cell => {
            cell.addEventListener('click', () => {
                const column = cell.dataset.column;
                if (!column) return;

                // Cr√©e et envoie dynamiquement un formulaire POST √† /play
                const form = document.createElement('form');
                form.method = 'POST';
                form.action = '/play';

                const input = document.createElement('input');
                input.type = 'hidden';
                input.name = 'column';
                input.value = parseInt(column) + 1; // colonnes 1 √† 7
                form.appendChild(input);

                document.body.appendChild(form);
                form.submit();
            });
        });

        // Effet de survol (highlight de la colonne)
        document.querySelectorAll('.board-table td').forEach(cell => {
            cell.addEventListener('mouseenter', () => {
                const column = cell.dataset.column;
                const cells = document.querySelectorAll(`.board-table tr td:nth-child(${parseInt(column) + 1})`);
                cells.forEach(c => c.classList.add('highlight'));
            });
            cell.addEventListener('mouseleave', () => {
                const column = cell.dataset.column;
                const cells = document.querySelectorAll(`.board-table tr td:nth-child(${parseInt(column) + 1})`);
                cells.forEach(c => c.classList.remove('highlight'));
            });
        });
    </script>
</body>
</html>
